{% extends "layout.html" %}
{% block content %}
<!-- Design Loaded Rev4 -->
<h1>Create Your Name Flower</h1>

<form method="POST" action="{{ url_for('design') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <label for="nameInput">Name</label>
    <input
        type="text"
        id="nameInput"
        name="name"
        placeholder="Enter a name"
        required
        autocomplete="off"
    >

    <label for="monthSelect">Birth Month</label>
    <select id="monthSelect" name="month" required>
        <option value="">Select month</option>
        <option value="january">January</option>
        <option value="february">February</option>
        <option value="march">March</option>
        <option value="april">April</option>
        <option value="may">May</option>
        <option value="june">June</option>
        <option value="july">July</option>
        <option value="august">August</option>
        <option value="september">September</option>
        <option value="october">October</option>
        <option value="november">November</option>
        <option value="december">December</option>
    </select>

    <div class="preview-controls">
        <button type="button" id="previewButton">Preview</button>
        <button type="submit">Save Project</button>
    </div>
</form>

<!-- =========================
     PREVIEW AREA
     ========================= -->
<div class="preview-area" aria-live="polite">

    <img
        id="flowerImg"
        src="{{ url_for('static', filename='flowers/default.png') }}"
        alt="Flower preview"
        class="flower-img"
    >

    <!-- STEM LETTER STACK -->
    <div id="stemLetters" class="stem-letters"></div>

</div>

<!-- =========================
     STEM + PREVIEW STYLES
     ========================= -->
<style>
.preview-area {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stem-letters {
    display: flex;
    flex-direction: column-reverse; /* ðŸ”‘ bottom â†’ top */
    align-items: center;
    margin-top: 10px;
}

.stem-letter {
    font-size: 20px;
    line-height: 1.2;
    font-family: serif;
}

.stem-letter.stem-start::before {
    content: "";
    display: block;
    width: 2px;
    height: 22px;
    background: #222;
    margin: 0 auto 2px auto;
}
</style>

<!-- =========================
     PREVIEW LOGIC
     ========================= -->
<script>
document.addEventListener("DOMContentLoaded", () => {

    const nameInput = document.getElementById("nameInput");
    const monthSelect = document.getElementById("monthSelect");
    const previewButton = document.getElementById("previewButton");
    const flowerImg = document.getElementById("flowerImg");
    const stemLetters = document.getElementById("stemLetters");

    function updatePreview() {
        const rawName = nameInput.value.trim();

        stemLetters.innerHTML = "";

        if (!rawName) {
            flowerImg.src = "{{ url_for('static', filename='flowers/default.png') }}";
            return;
        }

        // Letters only, natural order
        const letters = rawName.replace(/[^a-zA-Z]/g, "").split("");
        if (!letters.length) return;

        // Insert letters in order
        letters.forEach((char, index) => {
            const span = document.createElement("div");
            span.classList.add("stem-letter");

            // FIRST letter = bottom anchor
            if (index === 0) {
                span.classList.add("stem-start");
                span.textContent = char.toLowerCase();
            } else {
                span.textContent = char;
            }

            stemLetters.appendChild(span);
        });

        // Update flower image
        if (monthSelect.value) {
            flowerImg.src = `{{ url_for('static', filename='flowers') }}/${monthSelect.value}.png`;
            flowerImg.onerror = () => {
                flowerImg.src = "{{ url_for('static', filename='flowers/default.png') }}";
            };
        }
    }

    nameInput.addEventListener("input", updatePreview);
    monthSelect.addEventListener("change", updatePreview);
    previewButton.addEventListener("click", updatePreview);

});
</script>

{% endblock %}
